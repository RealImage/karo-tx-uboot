/*
 * Copyright 2012 <LW@KARO-electronics.de>
 * based on imx53-qsb.dts
 *   Copyright 2011 Freescale Semiconductor, Inc.
 *   Copyright 2011 Linaro Ltd.
 *
 * The code contained herein is licensed under the GNU General Public
 * License. You may obtain a copy of the GNU General Public License
 * Version 2 at the following locations:
 *
 * http://www.opensource.org/licenses/gpl-license.html
 * http://www.gnu.org/copyleft/gpl.html
 */

/dts-v1/;
/include/ ARCH_CPU_DTS

/ {
	model = "Ka-Ro electronics TX53 module";
	compatible = "karo,tx53", "fsl,imx53";

	chosen {
		bootargs = "init=/linuxrc console=ttymxc0,115200 root=/dev/mtdblock1 ro debug panic=1";
	};

	aliases {
		usbh1 = &usbh1;
		usbotg = &usbotg;
		usbphy = &usbphy;
	};

	clocks {
		ckih1 {
			clock-frequency = <0>;
		};
	};

	soc {
		extmc: extmc@00000000 {
			compatible = "fsl,extmc-bus", "simple-bus";
			#address-cells = <1>;
			#size-cells = <1>;
			reg = <0x00000000 0x40000000>;
			ranges;

			ipu@1e000000 {
				#address-cells = <1>;
				#size-cells = <0>;
				compatible = "fsl,imx-ipuv3";
				reg = <0x1e000000 0x02000000>;
				interrupts = <10 11>;
				status = "disabled";
			};
		};

		extmc: extmc@00000000 {
			ipu: ipu@1e000000 {
				status = "okay";
			};
		};

		aips1: aips@50000000 { /* AIPS1 */
			spba@50000000 {
				mmc0: esdhc@50004000 { /* ESDHC1 */
					cd-gpios = <&gpio3 24 0>;
					fsl,wp-controller;
					status = "okay";
				};

				mmc1: esdhc@50008000 { /* ESDHC2 */
					cd-gpios = <&gpio3 25 0>;
					status = "okay";
				};

				uart3: uart@5000c000 {
					status = "okay";
					fsl,uart-has-rtscts;
				};

				spi0: ecspi@50010000 { /* ECSPI1 */
					fsl,spi-num-chipselects = <2>;
					cs-gpios = <&gpio2 30 0 &gpio3 19 0>;
					status = "okay";

					spidev0: spi@0 {
						compatible = "spidev";
						reg = <0>;
						spi-max-frequency = <54000000>;
					};
				};
			};

			usbotg: imxotg@53f80000 {
				status = "okay";

				ignore-overcurrent;
				enable-wakeup;
				vbus-gpio = <&usbotg_vbus>;
			};

			usbh1: imxotg@53f80200 {
				status = "okay";

				ignore-overcurrent;
				enable-wakeup;
				vbus-gpio = <&usbh1_vbus>;
			};

			usbphy: imx-usb-phy@53f80800 {
				status = "okay";

				device-ports = <&usbotg>;
				host-ports = <&usbotg &usbh1>;
			};

			keypad@53f94000 {
				status = "okay";
				/* sample keymap */
				/* row/col 0,1 are mapped to KPP row/col 6,7 */
				linux,keymap = < 0x06060074 /* row 6, col 6, KEY_POWER */
					       	 0x06070052 /* row 6, col 7, KEY_KP0 */
					       	 0x0602004f /* row 6, col 2, KEY_KP1 */
					       	 0x06030050 /* row 6, col 3, KEY_KP2 */
					       	 0x07060051 /* row 7, col 6, KEY_KP3 */
					       	 0x0707004b /* row 7, col 7, KEY_KP4 */
					       	 0x0702004c /* row 7, col 2, KEY_KP5 */
					       	 0x0703004d /* row 7, col 3, KEY_KP6 */
					       	 0x02060047 /* row 2, col 6, KEY_KP7 */
					       	 0x02070048 /* row 2, col 7, KEY_KP8 */
					       	 0x02020049 /* row 2, col 2, KEY_KP9 */
						 >;
			};

			wdog@53f98000 { /* WDOG1 */
				status = "okay";
			};

			iomuxc@53fa8000 {
				compatible = "fsl,imx53-iomuxc-tx53";
				reg = <0x53fa8000 0x4000>;
			};

			pwm2: pwm@53fb8000 {
				status = "okay";
			};

			uart1: uart@53fbc000 {
				status = "okay";
				fsl,uart-has-rtscts;
			};

			uart2: uart@53fc0000 {
				status = "okay";
				fsl,uart-has-rtscts;
			};

			can1: flexcan@53fc8000 {
				status = "okay";
				transceiver-switch = <&flexcan_transceiver>;
			};

			can2: flexcan@53fcc000 {
				status = "okay";
				transceiver-switch = <&flexcan_transceiver>;
			};

			i2c@53fec000 { /* I2C3 */
				status = "okay";

				codec: sgtl5000@0a {
					compatible = "fsl,sgtl5000";
					reg = <0x0a>;
					VDDA-supply = <&reg_2p5v>;
					VDDIO-supply = <&reg_3p3v>;
				};

				touchscreen: tsc2007@48 {
					compatible = "ti,tsc2007";
					reg = <0x48>;
					interrupt-parent = <&gpio3>;
					interrupts = <26 0>;
					pendown-gpio = <&gpio3 26 1>;
					model = "2007";
					x-plate-ohms = <660>;
				};

				polytouch: edt-ft5x06@ {
					compatible = "edt,edt-ft5x06";
					reg = <0x38>;
					interrupt-parent = <&gpio6>;
					interrupts = <15>;
					reset-switch = <&edt_ft5x06_reset>;
					wake-switch = <&edt_ft5x06_wake>;
				};
			};
		};

		aips2: aips@60000000 {	/* AIPS2 */

			sdma@63fb0000 {
				fsl,sdma-ram-script-name = "sdma-imx53.bin";
			};

			i2c@63fc8000 { /* I2C1 */
				status = "okay";

				rtc1: ds1339@68 {
					compatible = "dallas,ds1339";
					reg = <0x68>;
					trickle-charge = <0xa5>;
/**/
					interrupt-parent = <&gpio4>;
					interrupts = <20 0>;
/**/
				};

				pmic: lt3589@48 {
					compatible = "lt,lt3589";
					reg = <0x48>;
				};
			};

			ssi@63fcc000 {
				status = "okay";
				rx-dma = <28>;
				tx-dma = <29>;
				i2s-sync-mode;
			};

			ssi@50014000 {
				status = "okay";
			};

			audmux@63fd0000 {
				status = "okay";
			};

			sound-card@0 {
				compatible = "fsl,imx-sgtl5000";
				status = "okay";
				/* '1' based port numbers according to datasheet names */
				ssi-port = <1>;
				audmux-port = <5>;
				sysclk = <26000000>;
			};

			nand@63fdb000 {
				status = "okay";

				nand-bus-width = <8>;
				nand-ecc-mode = "hw";
				nand-on-flash-bbt;
			};

			ethernet@63fec000 {
				phy-mode = "rmii";
				phy-reset-gpios = <&gpio7 6 0>;
				status = "okay";
				phy-handle = <&phy0>;
				mac-address = [000000000000];

				phy0: ethernet-phy@0 {
					interrupt-parent = <&gpio2>;
					interrupts = <4>;
					device_type = "ethernet-phy";
				};
			};
		};
	};

	gpio-switch {
		compatible = "gpio-switches", "simple-bus";
		#address-cells = <1>;
		#size-cells = <0>;

		flexcan_transceiver: gpio-switch@0 {
			compatible = "linux,gpio-switch";
			gpio = <&gpio4 21 1>;
			label = "Flexcan Transceiver Enable";
			gpio-shared;
			init-state = <0>;
		};

		lcd_power: gpio-switch@1 {
			compatible = "linux,gpio-switch";
			gpio = <&gpio2 31 0>;
			label = "LCD Power Enable";
			init-state = <0>;
		};

		lcd_reset: gpio-switch@2 {
			compatible = "linux,gpio-switch";
			gpio = <&gpio3 29 1>;
			label = "LCD Reset";
			init-state = <1>;
		};

		edt_ft5x06_reset: gpio-switch@3 {
			compatible = "linux,gpio-switch";
			gpio = <&gpio2 22 1>;
			label = "EDT-FT5x06 RESET";
		};

		edt_ft5x06_wake: gpio-switch@4 {
			compatible = "linux,gpio-switch";
			gpio = <&gpio2 21 0>;
			label = "EDT-FT5x06 WAKE";
			init-state = <1>;
		};

		usbotg_vbus: gpio-switch@5 {
			compatible = "linux,gpio-switch";
			gpio = <&gpio1 7 0>;
			label = "USBOTG VBUS";
		};

		usbh1_vbus: gpio-switch@6 {
			compatible = "linux,gpio-switch";
			gpio = <&gpio3 31 0>;
			label = "USBH1 VBUS";
		};
	};

	leds {
		compatible = "gpio-leds";

		user {
			label = "Heartbeat";
			gpios = <&gpio2 20 0>;
			linux,default-trigger = "heartbeat";
		};
	};

	lcd {
		compatible = "of-gpio-lcd";
		parent = <&ipu>;

		power-switch = <&lcd_power>;
/*
		reset-switch = <&lcd_reset>;
		reset-delay-us = <300>;
*/
	};

	backlight: pwm-backlight {
		compatible = "pwm-backlight";

		pwm = <&pwm2>;
		inverted;
		max-brightness = <100>;
		dft-brightness = <50>;
		pwm-period-ns = <1000000>;
	};

	regulators {
		compatible = "simple-bus";

		reg_2p5v: 2p5v {
			compatible = "regulator-fixed";
			regulator-name = "2P5V";
			regulator-min-microvolt = <2500000>;
			regulator-max-microvolt = <2500000>;
			regulator-always-on;
		};

		reg_3p3v: 3p3v {
			compatible = "regulator-fixed";
			regulator-name = "3P3V";
			regulator-min-microvolt = <3300000>;
			regulator-max-microvolt = <3300000>;
			regulator-always-on;
		};
	};
};
